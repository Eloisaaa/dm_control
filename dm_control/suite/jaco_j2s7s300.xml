<mujoco model="two-link planar reacher">
    <! the j2s7s300 publishes its joint state at about 52 Hz wo optimization. Mujoco was unstable when timestep was gt .001. If we set gravity to -9.81 in the z dim, we aren't able to treat the controllers the same as we do the real robot (0 velocity results in no movement).  />
    <compiler angle="radian" meshdir="./common/kinova_meshes/" />
  <option integrator="RK4" solver="PGS" timestep="0.001" gravity="0 0 0" iterations="50"/>
  <size njmax="800" nconmax="150" />

  <include file="./common/skybox.xml"/>
  <include file="./common/visual.xml"/>
  <include file="./common/materials.xml"/>
  <asset>
        <mesh name="base" file="base.stl" />
        <mesh name="shoulder" file="shoulder.stl" />
        <mesh name="arm_half_1" file="arm_half_1.stl" />
        <mesh name="arm_half_2" file="arm_half_2.stl" />
        <mesh name="forearm" file="forearm.stl" />
        <mesh name="wrist_spherical_1" file="wrist_spherical_1.stl" />
        <mesh name="wrist_spherical_2" file="wrist_spherical_2.stl" />
        <mesh name="hand_3finger" file="hand_3finger.stl" />
        <mesh name="finger_proximal" file="finger_proximal.stl" />
        <mesh name="finger_distal" file="finger_distal.stl" />

<texture name="groundplane" type="2d" builtin="checker" rgb1=".25 .26 .25"
      rgb2=".22 .22 .22" width="100" height="100" mark="none" markrgb=".8 .8 .8"/>
    </asset>

 <default>
    <geom contype='1' conaffinity='1' condim='3' margin="0.001" />

    <joint limited="false" damping="0" armature=".01"/>

    <default class ="vizNcoll">
      <geom material="MatViz" type="mesh" condim="3" contype="1" conaffinity="1" margin="0.001"/>
      <joint pos="0 0 0" type="hinge"/>
    </default>
    <default class ="ground">
      <geom type="plane" margin="0.001" contype="1" />
    </default>
  </default>


 <worldbody>
    <light cutoff="200" diffuse="1.2 1.2 1.2" dir="-0 0 -1.3" directional="true" exponent="1" pos="0 0 1.3" specular=".1 .1 .1"/>

    <camera name="topview" pos="0 0 1.5" zaxis="0 0 1" fovy="45" ipd="0.068"/>

    <geom name="table" type="plane" pos="-.3 -.15 0" zaxis="0 0 1" size=".91 .3 .1" material="grid" condim=1 friction=0/>
    <!-- constrain on by placing fences in plane size is the "radius" of the rectangle (.5 h or w)--> 
    <!-- wall_y is facing the side where the power cables come into the robot -->
    <!--
-->
<!--
    <geom name="table" type="plane" pos="-.3 -.15 0" zaxis="0 0 1" size=".91 .3 .1" material="grid"/>
    <geom name="wall_y" type="plane" pos="0 .41 .02" zaxis="0 1 0"  size=".6 .02 .02" condim=1 friction=0 material="decoration"/>
    <geom name="wall_neg_y" type="plane" pos="0 -.87 .02" zaxis="0 1 0"  size=".6 .02 .02" condim=1 friction=0 material="decoration"/>
    <geom name="wall_x" type="plane" pos="-.6 -.235 .02" zaxis="1 0 0"  size=".02 .635 .02" condim=1 friction=0 material="decoration"/>
    <geom name="wall_neg_x" type="plane" pos=".6 -.235 .02" zaxis="1 0 0"  size=".02 .635 .02" condim=1 friction=0 material="decoration"/>

    <geom name="target" pos="3.5 3.5 3.5" material="target" type="sphere" size=".05"/>


    <geom name="wall_y" type="plane" pos="0 .41 3" zaxis="0 1 0"  size=".3 .02 .02" condim=1 friction=0 material="grid"/>
    <geom name="wall_neg_y" type="plane" pos="0 -.87 3" zaxis="0 1 0"  size=".3 .02 .02" condim=1 friction=0 material="grid"/>
    <geom name="wall_x" type="plane" pos="-.6 -.235 3" zaxis="1 0 0"  size=".02 .335 .02" condim=1 friction=0 material="grid"/>
    <geom name="wall_neg_x" type="plane" pos=".6 -.235 3" zaxis="1 0 0"  size=".02 .335 .02" condim=1 friction=0 material="grid"/>

--> 




    <geom name='base' type="mesh" pos="0 0 0" rgba="0.17 0.17 0.17 1" mesh="base" />
    <!-- robot -->
    <body name="jaco_link_1" pos="0 0 0.15675" quat="0 0 1 0">
       <inertial pos="0 -0.002 -0.0605" mass="0.7477" diaginertia="0.00152032 0.00152032 0.00059816" />
       <joint name="jaco_joint_1" pos="0 0 0" axis="0 0 1" limited="true" range="-6.28319 6.28319" />
       <geom name="jaco_link_1" type="mesh" rgba="0.17 0.17 0.17 1" mesh="shoulder" />
 
     <body name="jaco_link_2"  pos="0 0.0016 -0.11875" quat="0 0 -0.707107 0.707107">
       <inertial pos="0 -0.103563 0" quat="0.707107 0.707107 0 0" mass="0.8447" diaginertia="0.00247074 0.00247074 0.000380115" />
       <joint name="jaco_joint_2" pos="0 0 0" axis="0 0 1" limited="true" range="0.820305 5.46288" />
       <geom name="jaco_link_2" type="mesh" rgba="0.17 0.17 0.17 1" mesh="arm_half_1" />

      <body name="jaco_link_3" pos="0 -0.205 0" quat="0.707107 -0.707107 0 0">
        <inertial pos="0 0 -0.102245" mass="0.8447" diaginertia="0.00247074 0.00247074 0.000380115" />
        <joint name="jaco_joint_3" pos="0 0 0" axis="0 0 1" limited="true" range="-6.28319 6.28319" />
        <geom name="jaco_link_3" type="mesh" rgba="0.17 0.17 0.17 1" mesh="arm_half_2" />

      <body name="jaco_link_4"  pos="0 0 -0.205" quat="0 0 0.707107 0.707107">
        <inertial pos="0 0.081 -0.0086" quat="0.707107 0.707107 0 0" mass="0.6763" diaginertia="0.00142022 0.00142022 0.000304335" />
        <joint name="jaco_joint_4" pos="0 0 0" axis="0 0 1" limited="true" range="0.523599 5.75959" />
        <geom name="jaco_link_4" type="mesh" rgba="0.17 0.17 0.17 1" mesh="forearm" />

      <body name="jaco_link_5"  pos="0 0.2073 -0.0114" quat="0 0 -0.707107 0.707107">
         <inertial pos="0 0.00288489 -0.0541933" mass="0.463" diaginertia="0.000432132 0.000432132 9.26e-05" />
         <joint name="jaco_joint_5" pos="0 0 0" axis="0 0 1" limited="true" range="-6.28319 6.28319" />
         <geom name="jaco_link_5" type="mesh" rgba="0.17 0.17 0.17 1" mesh="wrist_spherical_1" />

      <body name="jaco_link_6" pos="0 0 -0.10375" quat="0 0 0.707107 0.707107">
         <inertial pos="0 0.0497209 -0.00285628" quat="0.707107 0.707107 0 0" mass="0.463" diaginertia="0.000432132 0.000432132 9.26e-05" />
         <joint name="jaco_joint_6" pos="0 0 0" axis="0 0 1" limited="true" range="1.13446 5.14872" />
         <geom name="jaco_link_6" type="mesh" rgba="0.17 0.17 0.17 1" mesh="wrist_spherical_2" />

      <body name="jaco_link_7" pos="0 0.10375 0" quat="0 0 -0.707107 0.707107">
         <inertial pos="0 0 -0.06" quat="0.5 0.5 -0.5 0.5" mass="0.99" diaginertia="0.0005816 0.000345324 0.000345324" />
         <joint name="jaco_joint_7" pos="0 0 0" axis="0 0 1" limited="true" range="-6.28319 6.28319" />
         <geom name="jaco_link_7" type="mesh" rgba="0.73 0.73 0.73 1" mesh="hand_3finger" />

      <body name="jaco_link_finger_1" pos="0.00279 0.03126 -0.11467" quat="0.379408 -0.662973 -0.245899 0.596699">
         <inertial pos="0.022 0 0" mass="0.01" diaginertia="7.89997e-07 7.89997e-07 8e-08" />
         <joint name="jaco_joint_finger_1" pos="0 0 0" axis="0 0 1" limited="true" range="0 1.51" />
         <geom name="jaco_link_finger_1" type="mesh" rgba="0.17 0.17 0.17 1" mesh="finger_proximal" />

      <body name="jaco_link_finger_tip_1" pos="0.044 -0.003 0">
          <inertial pos="0.022 0 0" mass="0.01" diaginertia="7.89997e-07 7.89997e-07 8e-08" />
          <joint name="jaco_joint_finger_tip_1" pos="0 0 0" axis="0 0 1" limited="true" range="0 2" />
          <geom name="jaco_link_finger_tip_1" type="mesh" rgba="0.73 0.73 0.73 1" mesh="finger_distal" />
        </body>
        </body>
       <body name="jaco_link_finger_2" pos="0.02226 -0.02707 -0.11482" quat="0.659653 -0.37146 0.601679 -0.254671">
           <inertial pos="0.022 0 0" mass="0.01" diaginertia="7.89997e-07 7.89997e-07 8e-08" />
           <joint name="jaco_joint_finger_2" pos="0 0 0" axis="0 0 1" limited="true" range="0 1.51" />
           <geom name="jaco_link_finger_2" type="mesh" rgba="0.17 0.17 0.17 1" mesh="finger_proximal" />

       <body name="jaco_link_finger_tip_2"  pos="0.044 -0.003 0">
           <inertial pos="0.022 0 0" mass="0.01" diaginertia="7.89997e-07 7.89997e-07 8e-08" />
           <joint name="jaco_joint_finger_tip_2" pos="0 0 0" axis="0 0 1" limited="true" range="0 2" />
           <geom name="jaco_link_finger_tip_2" type="mesh" rgba="0.73 0.73 0.73 1" mesh="finger_distal" />

        </body>
        </body>
       <body name="jaco_link_finger_3" pos="-0.02226 -0.02707 -0.11482" quat="0.601679 -0.254671 0.659653 -0.37146">
            <inertial pos="0.022 0 0" mass="0.01" diaginertia="7.89997e-07 7.89997e-07 8e-08" />
            <joint name="jaco_joint_finger_3" pos="0 0 0" axis="0 0 1" limited="true" range="0 1.51" />
            <geom name="jaco_link_finger_3" type="mesh" rgba="0.17 0.17 0.17 1" mesh="finger_proximal" />

       <body name="jaco_link_finger_tip_3" pos="0.044 -0.003 0">
             <inertial pos="0.022 0 0" mass="0.01" diaginertia="7.89997e-07 7.89997e-07 8e-08" />
             <joint name="jaco_joint_finger_tip_3" pos="0 0 0" axis="0 0 1" limited="true" range="0 2" />
             <geom name="jaco_link_finger_tip_3" type="mesh" rgba="0.73 0.73 0.73 1" mesh="finger_distal" />
        </body>
        </body>

        </body>
        </body>
        </body>
        </body>
        </body>
        </body>
        </body>



   <!--

    <geom name="wall_neg_x" type="plane" pos=".6 -.235 2" zaxis="1 0 0"  size=".2 .635 .01" material="decoration"/>
    <geom name="wall_neg_y" type="plane" pos="0 -.87 2" zaxis="0 1 0"  size=".6 .2 .01" material="decoration"/>




    <geom name="wall_neg_x" type="plane" pos=".6 -.235 2" zaxis="1 0 0"  size=".2 .635 .01" material="decoration"/>
   --> 
    <!--
    <geom name="wall_neg_z" type="plane" pos="0 -.235 .1" zaxis="0 0 1"  size=".6 .635 01" material="decoration"/>
    <geom name="wall_z" type="plane" pos="0 -.235 2" zaxis="0 0 1"  size=".6 .635 01" material="decoration"/>
-->


    <!-- Target -->
    </worldbody>

  <!-- actuators are not directly from urdf and are a best guess based on reading Kinova docs - likely some aspects are incorrect -->
  <!--  ================= Velocity actuators ================= /-->

   <!-- ctrl range prevents joint from turning this many radians - 
         according to kinova docs - big actuators should be limited to 
       36 deg/sec (.62 rad/sec), small to 48 deg/sec (.837 rad/sec), and fingers 1080 deg/sec 18.8

I'm not sure about kv. kv=55 was too high and caused instability. kv=25 seems to work
-->
  <actuator>
    <velocity joint='jaco_joint_1'  kv="35" name='jaco_act_1' ctrlrange="-.628 .628" ctrllimited="true"/>
    <velocity joint='jaco_joint_2'  kv="35" name='jaco_act_2' ctrlrange="-.628 .628" ctrllimited="true"/>
    <velocity joint='jaco_joint_3'  kv="35" name='jaco_act_3' ctrlrange="-.628 .628" ctrllimited="true"/>
    <velocity joint='jaco_joint_4'  kv="35" name='jaco_act_4' ctrlrange="-.628 .628" ctrllimited="true"/>
    <velocity joint='jaco_joint_5'  kv="25" name='jaco_act_5' ctrlrange="-.837 .837" ctrllimited="true"/>
    <velocity joint='jaco_joint_6'  kv="25" name='jaco_act_6' ctrlrange="-.837 .837" ctrllimited="true"/>
    <velocity joint='jaco_joint_7'  kv="25" name='jaco_act_7' ctrlrange="-.837 .837" ctrllimited="true"/>
    <velocity joint='jaco_joint_finger_1' kv="25" name='jaco_act_finger_1'  ctrlrange="-18.849 18.849" ctrllimited="true"/>
    <velocity joint='jaco_joint_finger_2' kv="25" name='jaco_act_finger_2'  ctrlrange="-18.849 18.849" ctrllimited="true"/>
    <velocity joint='jaco_joint_finger_3' kv="25" name='jaco_act_finger_3'  ctrlrange="-18.849 18.849" ctrllimited="true"/>
    <velocity joint='jaco_joint_finger_tip_1' kv="25" name='jaco_act_finger_tip_1' ctrlrange="-18.849 18.849" ctrllimited="true"/>
    <velocity joint='jaco_joint_finger_tip_2' kv="25" name='jaco_act_finger_tip_2' ctrlrange="-18.849 18.849" ctrllimited="true"/>
    <velocity joint='jaco_joint_finger_tip_3' kv="25" name='jaco_act_finger_tip_3' ctrlrange="-18.849 18.849" ctrllimited="true"/>
  </actuator>

   <!--  ================= Actuator Sensors ================= /-->
  <sensor>
    <actuatorvel actuator='jaco_act_1'  name='jaco_act_1_vel'/>
    <actuatorvel actuator='jaco_act_2'  name='jaco_act_2_vel'/>
    <actuatorvel actuator='jaco_act_3'  name='jaco_act_3_vel'/>
    <actuatorvel actuator='jaco_act_4'  name='jaco_act_4_vel'/>
    <actuatorvel actuator='jaco_act_5'  name='jaco_act_5_vel'/>
    <actuatorvel actuator='jaco_act_6'  name='jaco_act_6_vel'/>
    <actuatorvel actuator='jaco_act_7'  name='jaco_act_7_vel'/>
    <actuatorfrc actuator='jaco_act_1'  name='jaco_act_1_frc'/>
    <actuatorfrc actuator='jaco_act_2'  name='jaco_act_2_frc'/>
    <actuatorfrc actuator='jaco_act_3'  name='jaco_act_3_frc'/>
    <actuatorfrc actuator='jaco_act_4'  name='jaco_act_4_frc'/>
    <actuatorfrc actuator='jaco_act_5'  name='jaco_act_5_frc'/>
    <actuatorfrc actuator='jaco_act_6'  name='jaco_act_6_frc'/>
    <actuatorfrc actuator='jaco_act_7'  name='jaco_act_7_frc'/>
  </sensor>

    <keyframe>
        <key time="0" qpos="1.14 2.31 -.5 4.25 0 2.49 0.15 0 0 0 0 0 0" />
    </keyframe>

  </mujoco>
